<!-- TABLE HEADER ROW DEF -->
<cdk-header-row *cdkHeaderRowDef="_store.tableRow"
                data-rowtype="header"
                class="neg-table-header-row neg-table-header-row-main"
                [ngStyle]="_mainHeaderRowStyle"></cdk-header-row>

<!-- MULTI-HEADER ROW DEF & MULTI-HEADER GROUP ROW DEFINITION TEMPLATES -->
<ng-container *ngFor="let row of _store.metaRows.header;">
  <ng-container *ngIf="row.isGroup">
      <cdk-header-row *cdkHeaderRowDef="row.keys" data-rowtype="meta-header" class="neg-table-header-row neg-header-group-row {{ row.name }}"></cdk-header-row>
  </ng-container>
  <ng-container *ngIf="!row.isGroup">
      <cdk-header-row *cdkHeaderRowDef="row.keys" data-rowtype="meta-header" class="neg-table-header-row {{ row.name }}"></cdk-header-row>
  </ng-container>
</ng-container>

<!-- TABLE FOOTER ROW DEF -->
<cdk-footer-row *cdkFooterRowDef="_store.tableRow" data-rowtype="footer" class="neg-table-footer-row"></cdk-footer-row> <!-- TABLE FOOTER ROW DEF -->
<!-- MULTI-FOOTER ROW DEF -->
<ng-container *ngFor="let row of _store.metaRows.footer">   <!-- MULTI-FOOTER ROW DEF -->
  <cdk-footer-row *cdkFooterRowDef="row.keys" data-rowtype="meta-footer" class="neg-table-footer-row {{ row.name }}"></cdk-footer-row>
</ng-container>

<div class="neg-table-container">
  <neg-cdk-virtual-scroll-viewport class="neg-table-scroll-container">
    <neg-cdk-table>
      <!-- Row templates. The columns used are set at the row template level -->

      <!-- MULTI-HEADER/FOOTER CELL DEF -->
      <ng-container *ngFor="let meta of _store.meta">
        <ng-container *ngIf="(meta.header || meta.headerGroup) as c" [negTableColumnDef]="c">
          <neg-table-header-cell *cdkHeaderCellDef>
            <ng-container *ngTemplateOutlet="c.template; context: (c | tableCellContext:self)"></ng-container>
          </neg-table-header-cell>
        </ng-container>
        <ng-container *ngIf="meta.footer as c" [negTableColumnDef]="c">
          <neg-table-footer-cell *cdkFooterCellDef>
            <ng-container *ngTemplateOutlet="c.template; context: (c | tableCellContext:self)"></ng-container>
          </neg-table-footer-cell>
        </ng-container>
      </ng-container>
      <!-- MULTI-HEADER/FOOTER CELL DEF -->

       <!-- HEADER-RECORD-FOOTER CELL DEF -->
      <ng-container *ngFor="let c of _store.allTable" [negTableColumnDef]="c">
        <!-- TABLE HEADER CELL DEF -->
        <neg-table-header-cell *cdkHeaderCellDef
                              [observeSize]="c"></neg-table-header-cell>

        <!-- RECORD CELL DEF -->
        <neg-table-cell *cdkCellDef="let row"
                       [attr.tabindex]="cellFocus">
          <ng-container *ngTemplateOutlet="c.cellTpl; context: (row | tableCellContext:c:self)"></ng-container>
        </neg-table-cell>

        <!-- TABLE FOOTER CELL DEF -->
        <neg-table-footer-cell *cdkFooterCellDef>
          <ng-container *ngTemplateOutlet="c.footerCellTpl; context: (c | tableCellContext:self)"></ng-container>
        </neg-table-footer-cell>
      </ng-container>
      <!-- HEADER-RECORD-FOOTER CELL DEF -->

      <!-- TABLE RECORD ROW DEFINITION TEMPLATES -->
      <neg-table-row *cdkRowDef="let row; columns: _store.tableRow;"></neg-table-row>

      <!-- TABLE RECORD ROW DEFINITION TEMPLATES -->
    </neg-cdk-table>
    <div [style.minWidth]="_cdkTable?.minWidth" class="neg-table-space-fill"></div>
  </neg-cdk-virtual-scroll-viewport>

  <ng-container #beforeContent></ng-container>
  <ng-content></ng-content>
  <ng-container #afterContent></ng-container>

</div>

<ng-template #fbTableCell let-value="value">{{value}}</ng-template>
<ng-template #fbHeaderCell let-column="col">{{column.label}}</ng-template>
<ng-template #fbFooterCell let-column="col">{{column.label}}</ng-template>
