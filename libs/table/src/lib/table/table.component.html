<!-- TABLE HEADER ROW DEF -->
<cdk-header-row *cdkHeaderRowDef="_store.tableRow"
                class="sg-table-header-row sg-table-header-row-main"
                [ngStyle]="_mainHeaderRowStyle"></cdk-header-row>

<!-- MULTI-HEADER ROW DEF & MULTI-HEADER GROUP ROW DEFINITION TEMPLATES -->
<ng-container *ngFor="let row of _store.metaRows.header;">
  <cdk-header-row *cdkHeaderRowDef="row.keys" class="sg-table-header-row {{ row.name }}" [class.sg-header-group-row]="row.isGroup"></cdk-header-row>
</ng-container>

<!-- TABLE FOOTER ROW DEF -->
<cdk-footer-row *cdkFooterRowDef="_store.tableRow" class="sg-table-footer-row"></cdk-footer-row> <!-- TABLE FOOTER ROW DEF -->
<!-- MULTI-FOOTER ROW DEF -->
<ng-container *ngFor="let row of _store.metaRows.footer">   <!-- MULTI-FOOTER ROW DEF -->
  <cdk-footer-row *cdkFooterRowDef="row.keys" class="sg-table-footer-row {{ row.name }}"></cdk-footer-row>
</ng-container>

<div class="sg-table-container">
  <div class="sg-table-scroll-container">
    <sg-cdk-table [trackBy]="trackBy">
      <!-- Row templates. The columns used are set at the row template level -->

      <!-- MULTI-HEADER/FOOTER CELL DEF -->
      <ng-container *ngFor="let meta of _store.meta">
        <ng-container *ngIf="(meta.header || meta.headerGroup) as c" [sgTableColumnDef]="c">
          <sg-table-header-cell *cdkHeaderCellDef>
            <ng-container *ngTemplateOutlet="c.template; context: (c | tableCellContext:self)"></ng-container>
          </sg-table-header-cell>
        </ng-container>
        <ng-container *ngIf="meta.footer as c" [sgTableColumnDef]="c">
          <sg-table-footer-cell *cdkFooterCellDef>
            <ng-container *ngTemplateOutlet="c.template; context: (c | tableCellContext:self)"></ng-container>
          </sg-table-footer-cell>
        </ng-container>
      </ng-container>
      <!-- MULTI-HEADER/FOOTER CELL DEF -->

       <!-- HEADER-RECORD-FOOTER CELL DEF -->
      <ng-container *ngFor="let c of _store.table" [sgTableColumnDef]="c">
        <!-- TABLE HEADER CELL DEF -->
        <sg-table-header-cell *cdkHeaderCellDef
                              [observeSize]="c"></sg-table-header-cell>

        <!-- RECORD CELL DEF -->
        <sg-table-cell *cdkCellDef="let row"
                       [attr.tabindex]="cellFocus">
          <ng-container *ngTemplateOutlet="c.cellTpl; context: (row | tableCellContext:c:self)"></ng-container>
        </sg-table-cell>

        <!-- TABLE FOOTER CELL DEF -->
        <sg-table-footer-cell *cdkFooterCellDef>
          <ng-container *ngTemplateOutlet="c.footerCellTpl; context: (c | tableCellContext:self)"></ng-container>
        </sg-table-footer-cell>
      </ng-container>
      <!-- HEADER-RECORD-FOOTER CELL DEF -->

      <!-- TABLE RECORD ROW DEFINITION TEMPLATES -->
      <sg-table-row *cdkRowDef="let row; columns: _store.tableRow;"
                    (click)="rowClicked.next({ event: $event, row: row })"></sg-table-row>

      <!-- TABLE RECORD ROW DEFINITION TEMPLATES -->
    </sg-cdk-table>
    <div class="sg-table-space-fill"></div>
  </div>

  <ng-container #beforeContent></ng-container>
  <ng-content></ng-content>
  <ng-container #afterContent></ng-container>

</div>

<ng-template #fbTableCell let-value="value">{{value}}</ng-template>
<ng-template #fbHeaderCell let-column="col">{{column.label}}</ng-template>
<ng-template #fbFooterCell let-column="col">{{column.label}}</ng-template>
