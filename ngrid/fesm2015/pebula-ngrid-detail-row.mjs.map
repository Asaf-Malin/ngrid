{"version":3,"file":"pebula-ngrid-detail-row.mjs","sources":["../../../../libs/ngrid/detail-row/src/lib/detail-row/tokens.ts","../../../../libs/ngrid/detail-row/src/lib/detail-row/row.ts","../../../../libs/ngrid/detail-row/src/lib/detail-row/directives.ts","../../../../libs/ngrid/detail-row/src/lib/detail-row/detail-row-controller.ts","../../../../libs/ngrid/detail-row/src/lib/detail-row/detail-row-plugin.ts","../../../../libs/ngrid/detail-row/src/lib/table-detail-row.module.ts","../../../../libs/ngrid/detail-row/src/pebula-ngrid-detail-row.ts"],"sourcesContent":["export interface PblDetailsRowToggleEvent<T = any> {\n  row: T;\n  expended: boolean;\n  toggle(): void;\n}\n\nexport const PLUGIN_KEY: 'detailRow' = 'detailRow';\n","import {\n  ChangeDetectionStrategy,\n  Component,\n  OnInit,\n  OnDestroy,\n  ViewEncapsulation,\n  ViewContainerRef,\n  ViewChild,\n} from '@angular/core';\nimport { ENTER, SPACE } from '@angular/cdk/keycodes';\nimport { CdkRow } from '@angular/cdk/table';\n\nimport { unrx } from '@asafmalin/ngrid/core';\nimport { PblNgridRowComponent } from '@asafmalin/ngrid';\nimport { PblDetailsRowToggleEvent, PLUGIN_KEY } from './tokens';\nimport { DetailRowController } from './detail-row-controller';\n\ndeclare module '@asafmalin/ngrid/lib/grid/context/types' {\n  interface ExternalRowContextState {\n    detailRow: boolean;\n  }\n}\n\nexport const PBL_NGRID_ROW_TEMPLATE = '<ng-content select=\".pbl-ngrid-row-prefix\"></ng-content><ng-container #viewRef></ng-container><ng-content select=\".pbl-ngrid-row-suffix\"></ng-content>';\n\n@Component({\n  selector: 'pbl-ngrid-row[detailRow]',\n  exportAs: 'pblNgridDetailRow',\n  host: { // tslint:disable-line:no-host-metadata-property\n    class: 'pbl-ngrid-row pbl-row-detail-parent',\n    role: 'row',\n    '[attr.tabindex]': 'grid.rowFocus',\n    '(keydown)': 'handleKeydown($event)'\n  },\n  template: PBL_NGRID_ROW_TEMPLATE,\n  styles: [ `.pbl-row-detail-parent { position: relative; cursor: pointer; }` ],\n  providers: [\n    { provide: CdkRow, useExisting: PblNgridDetailRowComponent }\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None,\n})\nexport class PblNgridDetailRowComponent extends PblNgridRowComponent implements OnInit, OnDestroy, PblDetailsRowToggleEvent {\n\n  get expended(): boolean {\n    return this.opened;\n  }\n\n  get height() {\n    return super.height + this.controller.getDetailRowHeight(this);\n  }\n\n  get row() { return this.context.$implicit; }\n\n  // We must explicitly define the inherited properties which have angular annotations\n  // Because angular will not detect them when building this library.\n  // TODO: When moving up to IVY see if this one get fixed\n  @ViewChild('viewRef', { read: ViewContainerRef, static: true }) _viewRef: ViewContainerRef;\n\n  private opened = false;\n  private plugin: import('./detail-row-plugin').PblNgridDetailRowPluginDirective<any>;\n  private controller: DetailRowController;\n\n  ngOnInit(): void {\n    super.ngOnInit();\n    this.plugin.addDetailRow(this);\n    const tradeEvents = this._extApi.pluginCtrl.getPlugin('targetEvents');\n\n    tradeEvents.cellClick\n      .pipe(unrx(this))\n      .subscribe( event => {\n        if (event.type === 'data' && event.row === this.context.$implicit) {\n          const { excludeToggleFrom } = this.plugin;\n          if (!excludeToggleFrom || !excludeToggleFrom.some( c => event.column.id === c )) {\n            this.toggle();\n          }\n        }\n      });\n\n    tradeEvents.rowClick\n      .pipe(unrx(this))\n      .subscribe( event => {\n        if (!event.root && event.type === 'data' && event.row === this.context.$implicit) {\n          this.toggle();\n        }\n      });\n  }\n\n  ngOnDestroy(): void {\n    unrx.kill(this);\n    this.plugin.removeDetailRow(this);\n    this.controller.clearDetailRow(this, true);\n    super.ngOnDestroy();\n  }\n\n  updateRow() {\n    if (super.updateRow()) { // only if row has changed (TODO: use identity based change detection?)\n      switch (this.plugin.whenContextChange) {\n        case 'context':\n          const isContextOpened = !!this.context.getExternal('detailRow');\n          isContextOpened && this.opened\n            ? this.controller.updateDetailRow(this) // if already opened, just update the context\n            : this.toggle(isContextOpened, true) // if not opened, force to the context state\n          ;\n          break;\n        case 'render':\n          if (this.opened) {\n            this.controller.updateDetailRow(this);\n          }\n          break;\n        case 'close':\n          this.toggle(false, true);\n          break;\n      }\n      this.plugin.markForCheck();\n      this.controller.detectChanges(this);\n      this.plugin.toggledRowContextChange.next(this);\n      return true;\n    }\n    return false;\n  }\n\n  toggle(forceState?: boolean, fromRender = false): void {\n    if (this.opened !== forceState) {\n      let opened = false;\n      if (this.opened) {\n        this.controller.clearDetailRow(this, fromRender);\n        this.element.classList.remove('pbl-row-detail-opened');\n      } else if (this.controller.render(this, fromRender)) {\n        opened = true;\n        this.element.classList.add('pbl-row-detail-opened');\n      }\n\n      if (this.opened !== opened) {\n        this.opened = opened;\n        this.context.setExternal('detailRow', opened, true);\n        this.plugin.detailRowToggled(this);\n      }\n    }\n  }\n\n  /**\n   * @internal\n   */\n  handleKeydown(event: KeyboardEvent): void {\n    if ( event.target === this.element ) {\n      const keyCode = event.keyCode;\n      const isToggleKey = keyCode === ENTER || keyCode === SPACE;\n      if ( isToggleKey ) {\n        event.preventDefault(); // prevents the page from scrolling down when pressing space\n        this.toggle();\n      }\n    }\n  }\n\n  protected onCtor() {\n    super.onCtor();\n    this.plugin = this._extApi.pluginCtrl.getPlugin(PLUGIN_KEY); // TODO: THROW IF NO PLUGIN...\n    this.controller = this.plugin.detailRowCtrl;\n  }\n}\n","// tslint:disable:use-host-property-decorator\nimport {\n  Component,\n  Directive,\n  OnInit,\n  OnDestroy,\n  TemplateRef,\n  Input,\n} from '@angular/core';\n\nimport { PblNgridRegistryService, PblNgridSingleTemplateRegistry, PblNgridRowContext, PblNgridRowDef } from '@asafmalin/ngrid';\n\ndeclare module '@asafmalin/ngrid/core/lib/registry/types' {\n  interface PblNgridSingleRegistryMap {\n    detailRowParent?: PblNgridDetailRowParentRefDirective<any>;\n    detailRow?: PblNgridDetailRowDefDirective;\n  }\n}\n\nexport interface PblNgridDetailRowContext<T = any> {\n  $implicit: T;\n  rowContext: PblNgridRowContext<T>;\n  animation: {\n    /**\n     * When true, indicates that the toggle (open/close) trigger of the detail row was from a rendering operation and not a user interaction.\n     * For example, scrolling out of view or changing the row's context due to virtual scroll updates.\n     *\n     * This flag is here to note that allowing you to customize behavior, especially when using animation.\n     * You should disable animations (angular & CSS) when the toggle came from a rendering operation and not from user click to prevent\n     * flickering and strange behaviors with virtual scrolling.\n     *\n     * When using angular animation, you can use the `[@.disable]` binding to make sure no animations run (`[@.disable]=\"animation.fromRender\"`)\n     * or when using CSS animation, use a class to disable the animations.\n     *\n     * > If you're not using the dynamic virtual scroll or your animation is not changing the height, you can ignore this value.\n     */\n    fromRender: boolean;\n\n    /**\n     * Invoke this function to notify the grid that an animation operation has ended.\n     * This is required when `hasAnimation` is turned on on the structural directive `pblNgridDetailRowDef`.\n     * If hasAnimation is enabled and this function is not called the grid will not be able to measure the new height\n     * of the detail row effecting virtual scroll calculations.\n     *\n     * You should call via angular`s animation events `(@.myTrigger.done)=\"animation.end()\"` or if using CSS animations via `(animationend)=\"animation.end()\"`\n     *\n     * > If you're not using the dynamic virtual scroll or your animation is not changing the height, you can ignore this value.\n     */\n    end: () => void;\n  }\n}\n\n/**\n * Marks the element as the display element for the detail row itself.\n */\n@Directive({ selector: '[pblNgridDetailRowDef]' })\nexport class PblNgridDetailRowDefDirective extends PblNgridSingleTemplateRegistry<PblNgridDetailRowContext, 'detailRow'> {\n  readonly kind: 'detailRow' = 'detailRow';\n\n  /**\n   * Define the height measure strategy to use when the detail row is opened or closed.\n   *\n   * When we toggle the detail row we need to update the height so we can notify the dynamic virtual scroll to take this into account.\n   * If we have a toggle animation, the height must be measured at the end of the animation otherwise we can measure it once the element is created.\n   *\n   * By not setting value (the default) or setting false, the measurement will take place immediately.\n   * If we want to support animations we can apply 1 of 2 strategies:\n   *\n   * - `interaction` - If the toggle origin is from a user interaction (e.g. click) or a programmatic API then it WILL NOT\n   *                   measure the height until `animation.end()` is called on the detail row context.\n   *                   Otherwise, it will measure it immediately.\n   *                   A Non-Interaction origin can happen from scrolling out of view or changing the row's context due to virtual scroll updates.\n   *                   See `fromRender` on the context for more details.\n   *                   I.E: When `fromRender` is true, the grid will measure the height immediately, otherwise it will wait for you to call `animation.end()`\n   *\n   * - `always` - Will always assume animation is running when toggling the detail row and WILL NOT measure the height\n   *              until `animation.end()` is called on the detail row context.\n   *\n   * If you are using animation, we strongly suggest to use `interaction` mode!\n   *\n   * > If you're not using the dynamic virtual scroll or your animation is not changing the height, you can ignore this value.\n   */\n  // tslint:disable-next-line: no-input-rename\n  @Input('pblNgridDetailRowDefHasAnimation') hasAnimation: 'always' | 'interaction' | false | undefined;\n\n  constructor(tRef: TemplateRef<PblNgridDetailRowContext>, registry: PblNgridRegistryService) { super(tRef, registry); }\n\n}\n\n@Directive({\n  selector: '[pblNgridDetailRowParentRef]',\n  inputs: ['columns: pblNgridDetailRowParentRef', 'when: pblNgridDetailRowParentRefWhen'],\n})\nexport class PblNgridDetailRowParentRefDirective<T> extends PblNgridRowDef<T> implements OnInit, OnDestroy {\n\n  ngOnInit(): void {\n    this.registry.setSingle('detailRowParent', this as any);\n  }\n\n  ngOnDestroy(): void {\n    if (this.registry.getSingle('detailRowParent') === this) {\n      this.registry.setSingle('detailRowParent',  undefined);\n    }\n  }\n}\n","import { EmbeddedViewRef, ViewContainerRef } from '@angular/core';\nimport { PblNgridExtensionApi } from '@asafmalin/ngrid';\nimport { PblNgridDetailRowContext, PblNgridDetailRowDefDirective } from './directives';\nimport { PblNgridDetailRowComponent } from './row';\n\nconst NOOP = () => {};\n\ninterface DetailRowViewState {\n  viewRef: EmbeddedViewRef<PblNgridDetailRowContext>\n}\n\ninterface PendingOperation {\n  type: 'render' | 'clear';\n  fromRender: boolean;\n}\n\n/**\n * In charge of handling the lifecycle of detail row instances.\n * The whole lifecycle: Create, update, move, destroy, etc...\n *\n * This controller also sync's the rendering process to make sure we reuse detail rom elements within\n * a single rendering cycle (i.e. not long term caching but a short term one).\n * This is done for performance and to prevent flickering when a row is moved into a different element due to virtual scroll.\n * When this happen we just want to move all dom elements properly, swap the context and trigger change detection.\n * If we have left over rows to render we create new elements or if we have left over rows to clear, we remove them.\n * The logic for this relay on the fact that the row's context.$implicit is updated in a sync iteration by the cdk table\n * and afterwards we will have the onRenderRows event fired, allowing us to sync changes.\n * We also relay on the fact that the event run immediately after the iterations and everything is sync.\n *\n * > In the future, this is where we can support detail row caching\n */\nexport class DetailRowController {\n\n  private viewMap = new Map<PblNgridDetailRowComponent, DetailRowViewState>();\n  private pendingOps = new Map<PblNgridDetailRowComponent, PendingOperation>();\n  private deferOps = false;\n  private detailRowDef: PblNgridDetailRowDefDirective;\n\n  private runMeasure = () => this.extApi.grid.viewport.reMeasureCurrentRenderedContent();\n\n  constructor(private readonly vcRef: ViewContainerRef,\n              private readonly extApi: PblNgridExtensionApi) {\n    extApi.onInit(() => {\n      this.detailRowDef = extApi.grid.registry.getSingle('detailRow');\n      extApi.cdkTable.beforeRenderRows.subscribe(() => this.deferOps = true );\n      extApi.cdkTable.onRenderRows.subscribe(() => this.flushPendingOps());\n    });\n\n    extApi.grid.registry.changes\n      .subscribe( changes => {\n        for (const c of changes) {\n          switch (c.type) {\n            case 'detailRow':\n              if (c.op === 'remove') {\n                this.detailRowDef = undefined;\n              } else {\n                this.detailRowDef = c.value;\n              }\n              break;\n          }\n        }\n      });\n  }\n\n  render(parent: PblNgridDetailRowComponent, fromRender: boolean): boolean {\n    if (this.viewMap.has(parent)) {\n      this.pendingOps.delete(parent); // if clear, then render we don't want to clear it later\n      this.updateDetailRow(parent);\n      return true;\n    } else if (!this.deferOps) {\n      return this._render(parent, fromRender);\n    } else if (parent.context.$implicit && this.detailRowDef) {\n      this.pendingOps.set(parent, { type: 'render', fromRender });\n      return true;\n    }\n    return false;\n  }\n\n  clearDetailRow(parent: PblNgridDetailRowComponent, fromRender: boolean) {\n    const state = this.viewMap.get(parent);\n    if (state) {\n      if (this.deferOps) {\n        this.pendingOps.set(parent, { type: 'clear', fromRender });\n      } else {\n        this._clearDetailRow(parent, fromRender);\n      }\n    }\n  }\n\n  updateDetailRow(parent: PblNgridDetailRowComponent) {\n    const state = this.viewMap.get(parent);\n    if (state) {\n      Object.assign(state.viewRef.context, this.createDetailRowContext(parent, true));\n      state.viewRef.detectChanges();\n    }\n  }\n\n  getDetailRowHeight(parent: PblNgridDetailRowComponent) {\n    let total = 0;\n    const state = this.viewMap.get(parent);\n    if (state) {\n      for (const e of state.viewRef.rootNodes) {\n        total += e.getBoundingClientRect().height;\n      }\n    }\n    return total;\n  }\n\n  detectChanges(parent: PblNgridDetailRowComponent) {\n    const state = this.viewMap.get(parent);\n    if (state) {\n      state.viewRef.detectChanges();\n    }\n  }\n\n  private createDetailRowContext(parent: PblNgridDetailRowComponent, fromRender: boolean): PblNgridDetailRowContext {\n    return {\n      $implicit: parent.context.$implicit,\n      rowContext: parent.context,\n      animation: { fromRender, end: () => this.checkHasAnimation(fromRender) ? this.runMeasure() : undefined, },\n    }\n  }\n\n  private flushPendingOps() {\n    if (this.deferOps) {\n      this.deferOps = false;\n\n      const toRender: Array<[PblNgridDetailRowComponent, PendingOperation]> = [];\n      const toClear: Array<[PblNgridDetailRowComponent, PendingOperation]> = [];\n      for (const entry of this.pendingOps.entries()) {\n        const col = entry[1].type === 'clear' ? toClear : toRender;\n        col.push(entry);\n      }\n      this.pendingOps.clear();\n\n      for (const [parent, op] of toRender) {\n        if (this.viewMap.has(parent)) {\n          if (typeof ngDevMode === 'undefined' || ngDevMode) {\n            throw new Error('Invalid detail row state.');\n          }\n          return;\n        }\n        if (toClear.length) {\n          const [clearParent] = toClear.pop();\n\n          this.viewMap.set(parent, this.viewMap.get(clearParent));\n          this.viewMap.delete(clearParent);\n          this.insertElementsToRow(parent); // don't detect changes, we'll do it in updateDetailRow\n          this.updateDetailRow(parent);\n\n          // notify about size changes\n          if (!this.checkHasAnimation(op.fromRender)) {\n            this.runMeasure();\n          }\n        } else {\n          // when no more cleared left for reuse\n          this._render(parent, op.fromRender);\n        }\n      }\n\n      // remove cleared we can't reuse\n      for (const [parent, op] of toClear) {\n        this._clearDetailRow(parent, op.fromRender);\n      }\n    }\n  }\n\n  private _render(parent: PblNgridDetailRowComponent, fromRender: boolean): boolean {\n    if (parent.context.$implicit && this.detailRowDef) {\n      const context = this.createDetailRowContext(parent, fromRender);\n\n      this.viewMap.set(parent, { viewRef: this.vcRef.createEmbeddedView(this.detailRowDef.tRef, context) })\n      this.insertElementsToRow(parent, true);\n\n      // notify about size changes\n      if (!this.checkHasAnimation(fromRender)) {\n        this.runMeasure();\n      }\n      return true;\n    }\n    return false;\n  }\n\n  private _clearDetailRow(parent: PblNgridDetailRowComponent, fromRender: boolean) {\n    const state = this.viewMap.get(parent);\n    if (state) {\n      const { viewRef } = state;\n\n      if (viewRef.context.animation.fromRender !== fromRender) {\n        viewRef.context.animation.fromRender = fromRender;\n        viewRef.detectChanges();\n      }\n\n      viewRef.destroy();\n\n      if (!this.checkHasAnimation(fromRender)) {\n        this.runMeasure();\n      }\n\n      this.viewMap.delete(parent);\n    }\n  }\n\n  private insertElementsToRow(parent: PblNgridDetailRowComponent, detectChanges?: boolean) {\n    const { viewRef } = this.viewMap.get(parent);\n    const beforeNode = parent.element.nextSibling;\n    for (const e of viewRef.rootNodes) {\n      parent.element.parentElement.insertBefore(e, beforeNode);\n    }\n    if (detectChanges) {\n      viewRef.detectChanges();\n    }\n  }\n\n  private checkHasAnimation(fromRender: boolean) {\n    return this.detailRowDef.hasAnimation === 'always' || (this.detailRowDef.hasAnimation === 'interaction' && !fromRender);\n  }\n}\n","import { Directive, EventEmitter, Injector, Input, OnDestroy, Output, ComponentFactoryResolver, ComponentRef, NgZone, ViewContainerRef, Component } from '@angular/core';\nimport { BooleanInput, coerceBooleanProperty } from '@angular/cdk/coercion';\nimport { PblNgridComponent, PblNgridPluginController } from '@asafmalin/ngrid';\n\nimport { PblDetailsRowToggleEvent, PLUGIN_KEY } from './tokens';\nimport { PblNgridDetailRowComponent } from './row';\nimport { PblNgridDetailRowParentRefDirective } from './directives';\nimport { DetailRowController } from './detail-row-controller';\n\ndeclare module '@asafmalin/ngrid/lib/ext/types' {\n  interface PblNgridPluginExtension {\n    detailRow?: PblNgridDetailRowPluginDirective<any>;\n  }\n}\n\nexport const ROW_WHEN_TRUE = () => true;\nexport const ROW_WHEN_FALSE = () => false;\n\nexport function toggleDetailRow<T = any>(grid: PblNgridComponent<T>, row: T, forceState?: boolean): boolean | void {\n  const controller = PblNgridPluginController.find(grid);\n  if (controller) {\n    const plugin = controller.getPlugin(PLUGIN_KEY);\n    if (plugin) {\n      return plugin.toggleDetailRow(row, forceState);\n    }\n  }\n}\n\n@Directive({ selector: 'pbl-ngrid[detailRow]', exportAs: 'pblNgridDetailRow' })\nexport class PblNgridDetailRowPluginDirective<T> implements OnDestroy {\n  /**\n   * Detail row control (none / all rows / selective rows)\n   *\n   * A detail row is an additional row added below a row rendered with the context of the row above it.\n   *\n   * You can enable/disable detail row for the entire grid by setting `detailRow` to true/false respectively.\n   * To control detail row per row, provide a predicate.\n   */\n  @Input() get detailRow(): ( (index: number, rowData: T) => boolean ) | boolean { return this._detailRow; }\n  set detailRow(value: ( (index: number, rowData: T) => boolean ) | boolean ) {\n    if (this._detailRow !== value) {\n      const grid = this.grid;\n\n      if (typeof value === 'function') {\n        this._isSimpleRow = (index: number, rowData: T) => !(value as any)(index, rowData);\n        this._isDetailRow = value;\n      } else {\n        value = coerceBooleanProperty(value);\n        this._isDetailRow = value ? ROW_WHEN_TRUE : ROW_WHEN_FALSE;\n        this._isSimpleRow = value ? ROW_WHEN_FALSE : ROW_WHEN_TRUE;\n      }\n      this._detailRow = value;\n\n      if (grid.isInit) {\n        this.updateTable();\n      }\n    }\n  }\n\n  @Input() set singleDetailRow(value: boolean) {\n    value = coerceBooleanProperty(value);\n    if (this._forceSingle !== value) {\n      this._forceSingle = value;\n      if (value && this._openedRow && this._openedRow.expended) {\n        for (const detailRow of this._detailRowRows) {\n          if (detailRow.context.$implicit !== this._openedRow.row) {\n            detailRow.toggle(false);\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * A list of columns that will not trigger a detail row toggle when clicked.\n   */\n  @Input() excludeToggleFrom: string[];\n\n  /**\n   * Set the behavior when the row's context is changed while the detail row is opened  (another row is displayed in place of the current row) or closed.\n   *\n   * - context: use the context to determine if to open or close the detail row\n   * - ignore: don't do anything, leave as is (for manual intervention)\n   * - close: close the detail row\n   * - render: re-render the row with the new context\n   *\n   * The default behavior is `context`\n   *\n   * This scenario will pop-up when using pagination and the user move between pages or change the page size.\n   * It might also happen when the data is updated due to custom refresh calls on the datasource or any other scenario that might invoke a datasource update.\n   *\n   * The `ignore` phase, when used, will not trigger an update, leaving the detail row opened and showing data from the previous row.\n   * The `ignore` is intended for use with `toggledRowContextChange`, which will emit when the row context has changed, this will allow the developer to\n   * toggle the row (mimic `close`) or update the context manually. For example, if toggling open the detail row invokes a \"fetch\" operation that retrieves data for the detail row\n   * this will allow updates on context change.\n   *\n   * Usually, what you will want is \"context\" (the default) which will remember the last state of the row and open it based on it.\n   *\n   * > Note that for \"context\" to work you need to use a datasource in client side mode and it must have a primary/identity column (pIndex) or it will not be able to identify the rows.\n   *\n   * > Note that `toggledRowContextChange` fires regardless of the value set in `whenContextChange`\n   */\n  @Input() whenContextChange: 'ignore' | 'close' | 'render' | 'context' = 'context';\n\n  /**\n   * Emits whenever a detail row instance is toggled on/off\n   * Emits an event handler with the row, the toggle state and a toggle operation method.\n   */\n  @Output() toggleChange = new EventEmitter<PblDetailsRowToggleEvent<T>>();\n  /**\n   * Emits whenever the row context has changed while the row is toggled open.\n   * This scenario is unique and will occur only when a detail row is opened AND the parent row has changed.\n   *\n   * For example, when using pagination and the user navigates to the next/previous set or when the rows per page size is changed.\n   * It might also occur when the data is updated due to custom refresh calls on the datasource or any other scenario that might invoke a datasource update.\n   *\n   * Emits an event handler with the row, the toggle state and a toggle operation method.\n   */\n  @Output() toggledRowContextChange = new EventEmitter<PblDetailsRowToggleEvent<T>>();\n\n  public readonly detailRowCtrl: DetailRowController;\n\n  private _openedRow?: PblDetailsRowToggleEvent<T>;\n  private _forceSingle: boolean;\n  private _isSimpleRow: (index: number, rowData: T) => boolean = ROW_WHEN_TRUE;\n  private _isDetailRow: (index: number, rowData: T) => boolean = ROW_WHEN_FALSE;\n  private _detailRowRows = new Set<PblNgridDetailRowComponent>();\n  private _detailRow: ( (index: number, rowData: T) => boolean ) | boolean;\n  private _detailRowDef: PblNgridDetailRowParentRefDirective<T>;\n  private _defaultParentRef: ComponentRef<PblNgridDefaultDetailRowParentComponent>;\n  private _removePlugin: (grid: PblNgridComponent<any>) => void;\n  private _cdPending: boolean;\n  private readonly grid: PblNgridComponent<any>;\n\n  constructor(vcRef: ViewContainerRef,\n              private readonly pluginCtrl: PblNgridPluginController<T>,\n              private readonly ngZone: NgZone,\n              private readonly injector: Injector) {\n    this._removePlugin = pluginCtrl.setPlugin(PLUGIN_KEY, this);\n    this.grid = pluginCtrl.extApi.grid;\n    this.detailRowCtrl = new DetailRowController(vcRef, pluginCtrl.extApi);\n\n    pluginCtrl.onInit()\n      .subscribe(() => {\n        pluginCtrl.ensurePlugin('targetEvents'); // Depends on target-events plugin\n\n        this.grid.registry.changes\n          .subscribe( changes => {\n            for (const c of changes) {\n              switch (c.type) {\n                case 'detailRowParent':\n                  if (c.op === 'remove') {\n                    this.pluginCtrl.extApi.cdkTable.removeRowDef(c.value);\n                    this._detailRowDef = undefined;\n                  }\n                  this.setupDetailRowParent();\n                  break;\n              }\n            }\n          });\n\n        // if we start with an initial value, then update the grid cause we didn't do that\n        // when it was set (we cant cause we're not init)\n        // otherwise just setup the parent.\n        if (this._detailRow) {\n          this.updateTable();\n        } else {\n          this.setupDetailRowParent();\n        }\n      });\n  }\n\n  addDetailRow(detailRow: PblNgridDetailRowComponent): void {\n    this._detailRowRows.add(detailRow);\n  }\n\n  removeDetailRow(detailRow: PblNgridDetailRowComponent): void {\n    this._detailRowRows.delete(detailRow);\n  }\n\n  toggleDetailRow(row: any, forceState?: boolean): boolean | void {\n    for (const detailRow of this._detailRowRows) {\n      if (detailRow.context.$implicit === row) {\n        detailRow.toggle(forceState);\n        return detailRow.expended;\n      }\n    }\n  }\n\n  markForCheck() {\n    if (!this._cdPending) {\n      this._cdPending = true;\n      this.ngZone.runOutsideAngular(() => Promise.resolve()\n        .then(() => {\n          this.ngZone.run(() => {\n            this._cdPending = false;\n            this._defaultParentRef?.changeDetectorRef.markForCheck();\n          });\n        }));\n    }\n  }\n\n  ngOnDestroy(): void {\n    if (this._defaultParentRef) {\n      this._defaultParentRef.destroy();\n    }\n    this._removePlugin(this.grid);\n  }\n\n  /** @internal */\n  detailRowToggled(event: PblDetailsRowToggleEvent<T>): void {\n    // logic for closing previous row\n    const isSelf = this._openedRow && this._openedRow.row === event.row;\n    if (event.expended) {\n      if (this._forceSingle && this._openedRow && this._openedRow.expended && !isSelf) {\n        this._openedRow.toggle();\n      }\n      this._openedRow = event;\n    } else if (isSelf) {\n      this._openedRow = undefined;\n    }\n    this.toggleChange.emit(event);\n  }\n\n  private setupDetailRowParent(): void {\n    const grid = this.grid;\n    const cdkTable = this.pluginCtrl.extApi.cdkTable;\n    if (this._detailRowDef) {\n      cdkTable.removeRowDef(this._detailRowDef);\n      this._detailRowDef = undefined;\n    }\n    if (this.detailRow) {\n      let detailRow = this.pluginCtrl.extApi.registry.getSingle('detailRowParent');\n      if (detailRow) {\n        this._detailRowDef = detailRow = detailRow.clone();\n        Object.defineProperty(detailRow, 'when', { enumerable: true,  get: () => this._isDetailRow });\n      } else if (!this._defaultParentRef) {\n        // We don't have a template in the registry, so we register the default component which will push a new template to the registry\n        // TODO: move to module? set in root registry? put elsewhere to avoid grid sync (see event of registry change)...\n        this._defaultParentRef = this.injector.get(ComponentFactoryResolver)\n          .resolveComponentFactory(PblNgridDefaultDetailRowParentComponent)\n          .create(this.injector);\n        this._defaultParentRef.changeDetectorRef.detectChanges(); // kick it for immediate emission of the registry value\n        return;\n      }\n    }\n    this.resetTableRowDefs();\n  }\n\n  private resetTableRowDefs(): void {\n    if (this._detailRowDef) {\n      this._detailRow === false\n        ? this.pluginCtrl.extApi.cdkTable.removeRowDef(this._detailRowDef)\n        : this.pluginCtrl.extApi.cdkTable.addRowDef(this._detailRowDef)\n      ;\n    }\n  }\n\n  /**\n   * Update the grid with detail row info.\n   * Instead of calling for a change detection cycle we can assign the new predicates directly to the pblNgridRowDef instances.\n   */\n  private updateTable(): void {\n    this.grid._tableRowDef.when = this._isSimpleRow;\n    this.setupDetailRowParent();\n    // Once we changed the `when` predicate on the `CdkRowDef` we must:\n    //   1. Update the row cache (property `rowDefs`) to reflect the new change\n    this.pluginCtrl.extApi.cdkTable.updateRowDefCache();\n\n    //   2. re-render all rows.\n    // The logic for re-rendering all rows is handled in `CdkTable._forceRenderDataRows()` which is a private method.\n    // This is a workaround, assigning to `multiTemplateDataRows` will invoke the setter which\n    // also calls `CdkTable._forceRenderDataRows()`\n    // TODO: This is risky, the setter logic might change.\n    // for example, if material will chack for change in `multiTemplateDataRows` setter from previous value...\n    this.pluginCtrl.extApi.cdkTable.multiTemplateDataRows = !!this._detailRow;\n  }\n\n  static ngAcceptInputType_detailRow: BooleanInput | ( (index: number, rowData: any) => boolean );\n}\n\n/**\n * Use to set the a default `pblNgridDetailRowParentRef` if the user did not set one.\n * @internal\n */\n @Component({\n  selector: 'pbl-ngrid-default-detail-row-parent',\n  template: `<pbl-ngrid-row *pblNgridDetailRowParentRef=\"let row;\" detailRow></pbl-ngrid-row>`,\n})\nexport class PblNgridDefaultDetailRowParentComponent { }\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { CdkTableModule } from '@angular/cdk/table';\nimport { PblNgridModule, ngridPlugin } from '@asafmalin/ngrid';\nimport { PblNgridTargetEventsModule } from '@asafmalin/ngrid/target-events';\n\nimport { PLUGIN_KEY } from './detail-row/tokens';\nimport { PblNgridDetailRowParentRefDirective, PblNgridDetailRowDefDirective } from './detail-row/directives';\nimport { PblNgridDetailRowPluginDirective, PblNgridDefaultDetailRowParentComponent } from './detail-row/detail-row-plugin';\nimport { PblNgridDetailRowComponent } from './detail-row/row';\n\nconst DETAIL_ROW = [\n  PblNgridDetailRowPluginDirective,\n  PblNgridDetailRowComponent,\n  PblNgridDetailRowParentRefDirective,\n  PblNgridDetailRowDefDirective,\n];\n\n@NgModule({\n    imports: [CommonModule, CdkTableModule, PblNgridModule, PblNgridTargetEventsModule],\n    declarations: [DETAIL_ROW, PblNgridDefaultDetailRowParentComponent],\n    exports: [DETAIL_ROW]\n})\nexport class PblNgridDetailRowModule {\n  static readonly NGRID_PLUGIN = ngridPlugin({ id: PLUGIN_KEY }, PblNgridDetailRowPluginDirective);\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["i2.PblNgridDetailRowComponent","i3.PblNgridDetailRowParentRefDirective"],"mappings":"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"}